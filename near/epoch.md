## Epoch

在NEAR Protocol中，epoch是一个基本的时间单位，理想情况下为12小时。Epoch作为网络运行的重要周期，承担着多种关键功能。

### Epoch的基本概念

* **定义**：Epoch是NEAR区块链中的固定时间段，通常设计为12小时
* **区块数量**：每个epoch包含约43,200个区块（假设区块生成时间为1秒）
* **目的**：提供网络状态更新、验证者轮换和奖励分配的时间边界

### Epoch的主要功能

* **验证器轮换**：
  * 每个Epoch结束时，网络会重新选择和分配验证器
  * 这是通过质押量和随机性机制决定的，以确保验证器的公平分配和网络的安全性
  * 验证者选择过程在当前epoch结束前就已确定，为下一个epoch做准备

* **质押和奖励结算**：
  * 在每个Epoch结束时，网络会结算验证器和质押者的奖励
  * 根据验证器的表现（如成功打包区块的数量、在线时间）和质押者的质押量，分配奖励和罚款
  * 奖励包括区块奖励和交易费用的分配

* **状态检查点**：
  * Epoch作为时间边界，有助于网络进行状态检查点的创建和维护
  * 状态检查点确保网络的状态可以在需要时恢复，提供数据完整性和安全性
  * 这些检查点对于网络的长期稳定性和可靠性至关重要

* **治理和升级**：
  * Epoch结束时也是网络进行治理和升级的机会
  * 提案和变更可以在Epoch之间进行评估和部署，以确保网络的稳定和持续改进
  * 协议升级通常在epoch边界执行，以减少网络中断

### Epoch结束时的处理流程

每个epoch结束时，NEAR协议会执行以下关键步骤：

1. **收集和处理信息**：
   * 收集当前epoch的区块生产数据
   * 处理验证者的表现数据（出块率、在线时间等）
   * 统计网络活动和资源使用情况

2. **奖励计算与分配**：
   * 计算验证者奖励和铸币量
   * 根据质押比例分配奖励给验证者和委托人
   * 处理可能的惩罚（如双签或长时间离线）

3. **分片配置更新**：
   * 确定下一个和下下个epoch的分片布局
   * 更新分片配置信息，包括验证者分配
   * 优化分片结构以平衡网络负载

4. **未来epoch准备**：
   * 生成和保存下下个epoch的信息
   * 准备随机种子用于验证者选择
   * 更新网络参数和协议状态

### Epoch与网络安全

* **终结性保证**：Epoch边界提供了额外的区块终结性保证
* **攻击防御**：通过定期轮换验证者，减少长期控制攻击的风险
* **随机性引入**：每个epoch引入新的随机性，增强网络的不可预测性和安全性

